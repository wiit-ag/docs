<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><title>Octavia Loadbalancers | Documentation</title><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Octavia Loadbalancers" /><meta property="og:locale" content="en" /><meta name="description" content="The Octavia Loadbalancer" /><meta property="og:description" content="The Octavia Loadbalancer" /><link rel="canonical" href="/optimist/networking/octavia_loadbalancer/" /><meta property="og:url" content="/optimist/networking/octavia_loadbalancer/" /><meta property="og:site_name" content="Documentation" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-16T20:56:12+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Octavia Loadbalancers" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-05-16T20:56:12+00:00","datePublished":"2024-05-16T20:56:12+00:00","description":"The Octavia Loadbalancer","headline":"Octavia Loadbalancers","mainEntityOfPage":{"@type":"WebPage","@id":"/optimist/networking/octavia_loadbalancer/"},"url":"/optimist/networking/octavia_loadbalancer/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"><svg class="site-logo" width="44" height="51" viewBox="0 0 44 51" fill="none" focusable="false" xmlns="http://www.w3.org/2000/svg"><path d="M21.9985 0L32.9985 6.35022L38.1104 9.30107L31.1561 13.3166L29.5221 12.3727L21.9985 8.02952L14.4749 12.3727L6.95126 16.716V25.4024V34.0888L14.4749 38.432L21.9985 42.7753L29.5221 38.432L44 30.0733V38.1043L33 44.4561L22 50.8063L11 44.4561L0 38.1043V25.4024V12.7004L11 6.34871L21.9985 0ZM21.9985 34.6597L29.1657 30.5218L36.4764 26.3009L44 21.9577V13.9267L33 20.2784L22 26.6301V34.6597H21.9985ZM28.9543 30.6441L29.1672 30.5218L28.9543 30.6441Z" fill="#111" /><path d="M21.9985 34.6588L29.1658 30.5209L36.4764 26.3L44 21.9568V13.9258L33 20.2775L22 26.6292V34.6588H21.9985ZM28.9543 30.6432L29.1673 30.5209L28.9543 30.6432Z" fill="#111" /> </svg><div class="rp_title"> Documentation</div></a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"></ul><div class="nav-category">Elastic Cloud Enterprise</div><ul class="nav-list"><li class="nav-list-item"><a href="/ece/intro" class="nav-list-link">Introduction</a><li class="nav-list-item"><a href="/ece/shipdata/" class="nav-list-link">Shipping data to Elastic</a><li class="nav-list-item"><a href="/ece/updateilm/" class="nav-list-link">Changing Lifecycle Policies</a></ul><div class="nav-category">GKS</div><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in About GKS category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/about/" class="nav-list-link">About GKS</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/about/changelog-v2.21/" class="nav-list-link">GKS Changelog v2.21</a><li class="nav-list-item "><a href="/gks/about/changelog-v2.20/" class="nav-list-link">GKS Changelog v2.20</a><li class="nav-list-item "><a href="/gks/about/changelog-v2.19/" class="nav-list-link">GKS Changelog v2.19</a><li class="nav-list-item "><a href="/gks/about/changelog-v2.18/" class="nav-list-link">GKS Changelog v2.18</a><li class="nav-list-item "><a href="/gks/about/changelog-v2.17/" class="nav-list-link">GKS Changelog v2.17</a><li class="nav-list-item "><a href="/gks/about/kubernetesversions/" class="nav-list-link">Supported Kubernetes Versions</a></ul><li class="nav-list-item"><a href="/gks/gettingstarted/" class="nav-list-link">Getting Started</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Managing GKS Projects category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/managingprojects/" class="nav-list-link">Managing GKS Projects</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/managingprojects/creatingaproject/" class="nav-list-link">Creating a Project</a><li class="nav-list-item "><a href="/gks/managingprojects/projectusermanagement/" class="nav-list-link">Managing Users in a Project</a><li class="nav-list-item "><a href="/gks/managingprojects/projectserviceaccounts/" class="nav-list-link">Managing Service Account Tokens</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Cluster Lifecycle category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/clusterlifecycle/" class="nav-list-link">Cluster Lifecycle</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/clusterlifecycle/creatingacluster/" class="nav-list-link">Creating a Cluster</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/clustertemplates/" class="nav-list-link">Cluster Templates</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/upgradingacluster/" class="nav-list-link">Kubernetes Updates</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/cnichoices/" class="nav-list-link">CNI Choices</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/upgradingcni/" class="nav-list-link">CNI Updates</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/controlplaneconnector/" class="nav-list-link">Control Plane Connector</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/openstackcredentials/" class="nav-list-link">Changing Openstack Credentials</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/applicationcredentials/" class="nav-list-link">Using Openstack Application Credentials</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/deletingacluster/" class="nav-list-link">Deleting a Cluster</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/deprecationpolicy/" class="nav-list-link">Deprecation Policy</a><li class="nav-list-item "><a href="/gks/clusterlifecycle/clustermigrations/containerruntimeengine/" class="nav-list-link">Migration Container Runtime Engine</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Cluster Backups category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/clusterbackups/" class="nav-list-link">Cluster Backups</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/clusterbackups/etcdbackups/" class="nav-list-link">Etcd Backups and Restore</a><li class="nav-list-item "><a href="/gks/clusterbackups/restorepvcfromvolume/" class="nav-list-link">Restore a PVC from an Existing Openstack Volume</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Machine Deployments category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/machinedeployments/" class="nav-list-link">Machine Deployments</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/machinedeployments/machinedeployment/" class="nav-list-link">Machine Deployment</a><li class="nav-list-item "><a href="/gks/machinedeployments/nodeflavors/" class="nav-list-link">Choosing Node Flavors/Sizes</a><li class="nav-list-item "><a href="/gks/machinedeployments/clusternodesusagerate/" class="nav-list-link">Cluster Nodes Usage Rate</a><li class="nav-list-item "><a href="/gks/machinedeployments/add_ssh_key/" class="nav-list-link">Adding an SSH Key to an Existing Cluster</a><li class="nav-list-item "><a href="/gks/machinedeployments/updatingnodeos/" class="nav-list-link">Updating the OS of Worker Nodes</a><li class="nav-list-item "><a href="/gks/machinedeployments/multipleavailabilityzones/" class="nav-list-link">Multiple Availability Zones</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Access Management category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/accessmanagement/" class="nav-list-link">Access Management</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/accessmanagement/connectingtoacluster/" class="nav-list-link">Project-Based Access</a><li class="nav-list-item "><a href="/gks/accessmanagement/usingrbac/" class="nav-list-link">Role-Based Access Control (RBAC)</a><li class="nav-list-item "><a href="/gks/accessmanagement/revokingtoken/" class="nav-list-link">Revoking Tokens</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Kubernetes Applications category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/k8sapplications/" class="nav-list-link">Kubernetes Applications</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/k8sapplications/runningapplications/" class="nav-list-link">Running Applications in Kubernetes</a><li class="nav-list-item "><a href="/gks/k8sapplications/serviceaccounts/" class="nav-list-link">Managing Service Accounts</a><li class="nav-list-item "><a href="/gks/k8sapplications/externaldnsanddesignate/" class="nav-list-link">ExternalDNS with Designate</a><li class="nav-list-item "><a href="/gks/k8sapplications/timezones/" class="nav-list-link">Time Zone Management</a><li class="nav-list-item "><a href="/gks/k8sapplications/storageclasses/" class="nav-list-link">StorageClass Setup</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Add-On category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/gks/addons/" class="nav-list-link">Add-On</a><ul class="nav-list"><li class="nav-list-item "><a href="/gks/addons/cluster-autoscaler/" class="nav-list-link">Cluster Autoscaler</a></ul></ul><div class="nav-category">Oncite Open Edition</div><ul class="nav-list"><li class="nav-list-item"><a href="/edge/productoverview/" class="nav-list-link">Product Overview</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Operations Center category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/edge/operationscenter/" class="nav-list-link">Operations Center</a><ul class="nav-list"><li class="nav-list-item "><a href="/edge/operationscenter/vpnaas/" class="nav-list-link">VPN as a Service</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Openstack category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/edge/openstack/" class="nav-list-link">Openstack</a><ul class="nav-list"><li class="nav-list-item "><a href="/edge/openstack/create_vm/" class="nav-list-link">Create VM</a></ul><li class="nav-list-item"><a href="/edge/faq/" class="nav-list-link">FAQ</a></ul><div class="nav-category">Optimist</div><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Guided Tour category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/optimist/guided_tour/" class="nav-list-link">Guided Tour</a><ul class="nav-list"><li class="nav-list-item "><a href="/optimist/guided_tour/step01/" class="nav-list-link">01: The Horizon (Dashboard)</a><li class="nav-list-item "><a href="/optimist/guided_tour/step02/" class="nav-list-link">02: Create an SSH-Key with the Horizon (Dashboard)</a><li class="nav-list-item "><a href="/optimist/guided_tour/step03/" class="nav-list-link">03: Spawn a new Stack</a><li class="nav-list-item "><a href="/optimist/guided_tour/step04/" class="nav-list-link">04: Your way to the console</a><li class="nav-list-item "><a href="/optimist/guided_tour/step05/" class="nav-list-link">05: An overview of the most important OpenStackClient commands</a><li class="nav-list-item "><a href="/optimist/guided_tour/step06/" class="nav-list-link">06: Create and use your own SSH-Key</a><li class="nav-list-item "><a href="/optimist/guided_tour/step07/" class="nav-list-link">07: The first VM</a><li class="nav-list-item "><a href="/optimist/guided_tour/step08/" class="nav-list-link">08: Delete the first VM</a><li class="nav-list-item "><a href="/optimist/guided_tour/step09/" class="nav-list-link">09: Security Groups</a><li class="nav-list-item "><a href="/optimist/guided_tour/step10/" class="nav-list-link">10: Get access to the Internet; Create a network</a><li class="nav-list-item "><a href="/optimist/guided_tour/step11/" class="nav-list-link">11: Prepare access to the Internet; Add IPv6 to your network</a><li class="nav-list-item "><a href="/optimist/guided_tour/step12/" class="nav-list-link">12: A usable VM</a><li class="nav-list-item "><a href="/optimist/guided_tour/step13/" class="nav-list-link">13: The structured way to create an instance (with stacks)</a><li class="nav-list-item "><a href="/optimist/guided_tour/step14/" class="nav-list-link">14: Your first steps with HEAT</a><li class="nav-list-item "><a href="/optimist/guided_tour/step15/" class="nav-list-link">15: The first heat template</a><li class="nav-list-item "><a href="/optimist/guided_tour/step16/" class="nav-list-link">16: Get to know HEAT better</a><li class="nav-list-item "><a href="/optimist/guided_tour/step17/" class="nav-list-link">17: The network in Heat</a><li class="nav-list-item "><a href="/optimist/guided_tour/step18/" class="nav-list-link">18: Making your VM reachable via IPv4</a><li class="nav-list-item "><a href="/optimist/guided_tour/step19/" class="nav-list-link">19: Add IPv6 to your template</a><li class="nav-list-item "><a href="/optimist/guided_tour/step20/" class="nav-list-link">20: Build multiple VMs with HEAT</a><li class="nav-list-item "><a href="/optimist/guided_tour/step21/" class="nav-list-link">21: Start a VM with an SSD volume</a><li class="nav-list-item "><a href="/optimist/guided_tour/step22/" class="nav-list-link">22: Create a DNS record in Designate</a><li class="nav-list-item "><a href="/optimist/guided_tour/step23/" class="nav-list-link">23: Object Storage (S3 compatible)</a></ul><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in Networking category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/optimist/networking/" class="nav-list-link">Networking</a><ul class="nav-list"><li class="nav-list-item "><a href="/optimist/networking/port_forwarding/" class="nav-list-link">Port Forwarding on Floating IPs</a><li class="nav-list-item "><a href="/optimist/networking/shared_networks/" class="nav-list-link">Shared Networks</a><li class="nav-list-item "><a href="/optimist/networking/vpnaas/" class="nav-list-link">VPN as a Service</a><li class="nav-list-item active"><a href="/optimist/networking/octavia_loadbalancer/" class="nav-list-link active">Octavia Loadbalancers</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Storage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/optimist/storage/" class="nav-list-link">Storage</a><ul class="nav-list"><li class="nav-list-item "><button class="nav-list-expander btn-reset" aria-label="toggle items in S3 Compatible Object Storage category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/optimist/storage/s3_documentation/" class="nav-list-link">S3 Compatible Object Storage</a><ul class="nav-list"><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/createanduses3credentials/" class="nav-list-link">Create and Use S3 Credentials</a><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/createanddeletebucket/" class="nav-list-link">Create and Delete a Bucket</a><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/uploadanddeleteobject/" class="nav-list-link">Upload and delete an object</a><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/versioning/" class="nav-list-link">Enable and Disable Versioning, and Delete a versioned object</a><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/security/" class="nav-list-link">S3 Security</a><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/swiftservestaticwebsite/" class="nav-list-link">Swift - Serving a Static Website</a><li class="nav-list-item "> <a href="/optimist/storage/s3_documentation/backupwithrestic/" class="nav-list-link">Secure Backups with Restic and Rclone</a></ul><li class="nav-list-item "><a href="/optimist/storage/localstorage/" class="nav-list-link">Localstorage</a></ul><li class="nav-list-item"><a href="/optimist/faq/" class="nav-list-link">FAQ</a><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Specifications category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/optimist/specs/" class="nav-list-link">Specifications</a><ul class="nav-list"><li class="nav-list-item "><a href="/optimist/specs/flavor_specification/" class="nav-list-link">Flavor Specifications</a><li class="nav-list-item "><a href="/optimist/specs/default_quota/" class="nav-list-link">Default Quotas</a><li class="nav-list-item "><a href="/optimist/specs/application_credentials/" class="nav-list-link">Application Credentials</a><li class="nav-list-item "><a href="/optimist/specs/volume_specification/" class="nav-list-link">Volume Specifications</a><li class="nav-list-item "><a href="/optimist/specs/images/" class="nav-list-link">Images</a><li class="nav-list-item "><a href="/optimist/specs/shelving_instances/" class="nav-list-link">Shelving Instances</a></ul><li class="nav-list-item"><a href="/optimist/changelog/" class="nav-list-link">Changelog</a></ul></nav><a href="https://gec.io/company/zertifizierungen/" target="_blank"><div style="display: flex; justify-content: space-between; padding: 16px; width: 280px"> <img id="isoimage" src="https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/iso9001.webp" alt="ISO 9001" style="flex-grow: 1; object-fit: contain; height: 1.5rem; "> <img src="https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/iso27001.webp" alt="ISO 27001" style="flex-grow: 1; object-fit: contain; height: 1.5rem; "> <img src="https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/isae-3402-t2certified-logo-cmyk1-page-001_rdax_565x282_100.webp" alt="ISAE 3402" style="flex-grow: 1; object-fit: contain; height: 1.5rem;"></div></a> <script language="javascript" type="text/javascript"> var d = new Date(); document.getElementById("isoimage").src = "https://s3.es1.fra.optimist.gec.io/swift/v1/static/docs/iso9001.webp?ver=" + d.getTime(); </script></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Documentation" aria-label="Search Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><ul class="language-list"><li class="language-list-item"> <a class="language-list-link active" href=" /optimist/networking/octavia_loadbalancer/ " >English</a ><li class="language-list-item"> <a class="language-list-link" href=" /de/optimist/networking/octavia_loadbalancer/ " >Deutsch</a ></ul></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/optimist/networking/">Networking</a><li class="breadcrumb-nav-list-item"><span>Octavia Loadbalancers</span></ol></nav><div id="main-content" class="main-content"><main><h1 id="the-octavia-loadbalancer"> <a href="#the-octavia-loadbalancer" class="anchor-heading" aria-labelledby="the-octavia-loadbalancer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Octavia Loadbalancer</h1><h2 id="preface"> <a href="#preface" class="anchor-heading" aria-labelledby="preface"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Preface</h2><p><a href="https://wiki.openstack.org/wiki/Octavia">Octavia</a> is a highly-available and scalable open source load balancing solution designed to work with OpenStack. Octavia handles load balancing services by managing and configuring a fleet of virtual machines – also known as amphorae – in its project. These amphorae run a <a href="https://www.haproxy.com/">HAproxy</a>.</p><h2 id="first-steps"> <a href="#first-steps" class="anchor-heading" aria-labelledby="first-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> First Steps</h2><p>To use Octavia, the client first needs to be installed on your system. Instructions for the installation can be found in <a href="/optimist/guided_tour/step04/">Step 04</a> of our guide.</p><h2 id="creating-an-octavia-ladbalancer"> <a href="#creating-an-octavia-ladbalancer" class="anchor-heading" aria-labelledby="creating-an-octavia-ladbalancer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating an Octavia-Ladbalancer</h2><p>In our example we use the example subnet we’ve already created in <a href="/optimist/guided_tour/step10/">Step 10</a>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer create <span class="nt">--name</span> Beispiel-LB <span class="nt">--vip-subnet-id</span> 32259126-dd37-44d5-922c-99d68ee870cd
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| admin_state_up      | True                                 |
| created_at          | 2019-05-01T09:00:00                  |
| description         |                                      |
| flavor_id           |                                      |
| <span class="nb">id</span>                  | e94827f0-f94d-40c7-a7fd-b91bf2676177 |
| listeners           |                                      |
| name                | Beispiel-LB                          |
| operating_status    | OFFLINE                              |
| pools               |                                      |
| project_id          | b15cde70d85749689e08106f973bb002     |
| provider            | amphora                              |
| provisioning_status | PENDING_CREATE                       |
| updated_at          | None                                 |
| vip_address         | 10.0.0.10                            |
| vip_network_id      | f2a8f00e-204b-4c37-9d19-1d5c8e4efbf6 |
| vip_port_id         | 37fc5b34-ee07-49c8-b054-a8d591a9679f |
| vip_qos_policy_id   | None                                 |
| vip_subnet_id       | 32259126-dd37-44d5-922c-99d68ee870cd |
+---------------------+--------------------------------------+
</code></pre></div></div><p>Now Octavia spawns amphorae instances in the background.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer list
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| <span class="nb">id</span>                                   | name        | project_id                       | vip_address  | provisioning_status | provider |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| e94827f0-f94d-40c7-a7fd-b91bf2676177 | Beispiel-LB | b15cde70d85749689e08106f973bb002 | 10.0.0.10    | PENDING_CREATE      | amphora  |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
</code></pre></div></div><p>Once the provisioning_status is <code class="language-plaintext highlighter-rouge">ACTIVE</code>, the process has completed successfully and the Octavia load balancer can be further configured.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer list
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| <span class="nb">id</span>                                   | name        | project_id                       | vip_address  | provisioning_status | provider |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
| e94827f0-f94d-40c7-a7fd-b91bf2676177 | Beispiel-LB | b15cde70d85749689e08106f973bb002 | 10.0.0.10    | ACTIVE              | amphora  |
+--------------------------------------+-------------+----------------------------------+--------------+---------------------+----------+
</code></pre></div></div><h2 id="create-lb-listener"> <a href="#create-lb-listener" class="anchor-heading" aria-labelledby="create-lb-listener"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create LB listener</h2><p>In our example, we want to create a listener for HTTP on port 80. A listener here - as in other LB solutions - refers to the port of the front end.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer listener create <span class="nt">--name</span> Beispiel-listener <span class="nt">--protocol</span> HTTP <span class="nt">--protocol-port</span> 80 Beispiel-LB
+-----------------------------+--------------------------------------+
| Field                       | Value                                |
+-----------------------------+--------------------------------------+
| admin_state_up              | True                                 |
| connection_limit            | <span class="nt">-1</span>                                   |
| created_at                  | 2019-05-01T09:00:00                  |
| default_pool_id             | None                                 |
| default_tls_container_ref   | None                                 |
| description                 |                                      |
| <span class="nb">id</span>                          | 0a3312d1-8cf7-41a8-8d24-181246468cd7 |
| insert_headers              | None                                 |
| l7policies                  |                                      |
| loadbalancers               | e94827f0-f94d-40c7-a7fd-b91bf2676177 |
| name                        | Beispiel-listener                    |
| operating_status            | OFFLINE                              |
| project_id                  | b15cde70d85749689e08106f973bb002     |
| protocol                    | HTTP                                 |
| protocol_port               | 80                                   |
| provisioning_status         | PENDING_CREATE                       |
| sni_container_refs          | <span class="o">[]</span>                                   |
| timeout_client_data         | 50000                                |
| timeout_member_connect      | 5000                                 |
| timeout_member_data         | 50000                                |
| timeout_tcp_inspect         | 0                                    |
| updated_at                  | None                                 |
| client_ca_tls_container_ref |                                      |
| client_authentication       |                                      |
| client_crl_container_ref    |                                      |
+-----------------------------+--------------------------------------+
</code></pre></div></div><p>Once the <code class="language-plaintext highlighter-rouge">admin_state_up</code> is <code class="language-plaintext highlighter-rouge">true</code> the loadbalancer has been successfully created. The Octavia loadbalancer can be further configured at this point.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer listener list
+--------------------------------------+-----------------+-------------------+----------------------------------+----------+---------------+----------------+
| <span class="nb">id</span>                                   | default_pool_id | name              | project_id                       | protocol | protocol_port | admin_state_up |
+--------------------------------------+-----------------+-------------------+----------------------------------+----------+---------------+----------------+
| 0a3312d1-8cf7-41a8-8d24-181246468cd7 | None            | Beispiel-listener | b15cde70d85749689e08106f973bb002 | HTTP     |            80 | True           |
+--------------------------------------+-----------------+-------------------+----------------------------------+----------+---------------+----------------+
</code></pre></div></div><h2 id="create-lb-pool"> <a href="#create-lb-pool" class="anchor-heading" aria-labelledby="create-lb-pool"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create LB pool</h2><p>The LB-pool here refers to a collection of all objects (listeners, members, etc.) - comparable to a pool of public IP addresses from which one can be assigned. A pool for our example is created as follows:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer pool create <span class="nt">--name</span> Beispiel-pool <span class="nt">--lb-algorithm</span> ROUND_ROBIN <span class="nt">--listener</span> Beispiel-listener <span class="nt">--protocol</span> HTTP
+----------------------+--------------------------------------+
| Field                | Value                                |
+----------------------+--------------------------------------+
| admin_state_up       | True                                 |
| created_at           | 2019-05-01T09:00:00                  |
| description          |                                      |
| healthmonitor_id     |                                      |
| <span class="nb">id</span>                   | 4053e88e-c2b5-47c6-987e-4387d837c88d |
| lb_algorithm         | ROUND_ROBIN                          |
| listeners            | 0a3312d1-8cf7-41a8-8d24-181246468cd7 |
| loadbalancers        | e94827f0-f94d-40c7-a7fd-b91bf2676177 |
| members              |                                      |
| name                 | Beispiel-pool                        |
| operating_status     | OFFLINE                              |
| project_id           | b15cde70d85749689e08106f973bb002     |
| protocol             | HTTP                                 |
| provisioning_status  | PENDING_CREATE                       |
| session_persistence  | None                                 |
| updated_at           | None                                 |
| tls_container_ref    |                                      |
| ca_tls_container_ref |                                      |
| crl_container_ref    |                                      |
| tls_enabled          |                                      |
+----------------------+--------------------------------------+
</code></pre></div></div><p>It should be noted that with <code class="language-plaintext highlighter-rouge">openstack loadbalancer pool create --help</code> all possible settings can be displayed. The most common settings and their choices:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">--protocol</span>: <span class="o">{</span>TCP,HTTP,HTTPS,TERMINATED_HTTPS,PROXY,UDP<span class="o">}</span>
<span class="nt">--lb-algorithm</span> <span class="o">{</span>SOURCE_IP,ROUND_ROBIN,LEAST_CONNECTIONS<span class="o">}</span>
</code></pre></div></div><p>The pool has been successfully created when the <code class="language-plaintext highlighter-rouge">provisioning_status</code> has reached the status <code class="language-plaintext highlighter-rouge">ACTIVE</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer pool list
+--------------------------------------+---------------+----------------------------------+---------------------+----------+--------------+----------------+
| <span class="nb">id</span>                                   | name          | project_id                       | provisioning_status | protocol | lb_algorithm | admin_state_up |
+--------------------------------------+---------------+----------------------------------+---------------------+----------+--------------+----------------+
| 4053e88e-c2b5-47c6-987e-4387d837c88d | Beispiel-pool | b15cde70d85749689e08106f973bb002 | ACTIVE              | HTTP     | ROUND_ROBIN  | True           |
+--------------------------------------+---------------+----------------------------------+---------------------+----------+--------------+----------------+
</code></pre></div></div><h2 id="create-the-lb-member"> <a href="#create-the-lb-member" class="anchor-heading" aria-labelledby="create-the-lb-member"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create the LB <code class="language-plaintext highlighter-rouge">member</code></h2><p>For our loadbalancer to know which backends it is allowed to forward to, we still need a <code class="language-plaintext highlighter-rouge">member</code>, which we define as follows:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer member create <span class="nt">--subnet-id</span> 32259126-dd37-44d5-922c-99d68ee870cd <span class="nt">--address</span>  10.0.0.11 <span class="nt">--protocol-port</span> 80 Beispiel-pool
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| address             | 10.0.0.11                            |
| admin_state_up      | True                                 |
| created_at          | 2019-05-01T09:00:00                  |
| <span class="nb">id</span>                  | 703e27e0-e7fe-474b-b32d-68f9a8aeef07 |
| name                |                                      |
| operating_status    | NO_MONITOR                           |
| project_id          | b15cde70d85749689e08106f973bb002     |
| protocol_port       | 80                                   |
| provisioning_status | PENDING_CREATE                       |
| subnet_id           | 32259126-dd37-44d5-922c-99d68ee870cd |
| updated_at          | None                                 |
| weight              | 1                                    |
| monitor_port        | None                                 |
| monitor_address     | None                                 |
| backup              | False                                |
+---------------------+--------------------------------------+
</code></pre></div></div><p>and</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer member create <span class="nt">--subnet-id</span> 32259126-dd37-44d5-922c-99d68ee870cd <span class="nt">--address</span>  10.0.0.12 <span class="nt">--protocol-port</span> 80 Beispiel-pool
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| address             | 10.0.0.12                            |
| admin_state_up      | True                                 |
| created_at          | 2019-05-01T09:00:00                  |
| <span class="nb">id</span>                  | 2add1e17-73a6-4002-82af-538a3374e5dc |
| name                |                                      |
| operating_status    | NO_MONITOR                           |
| project_id          | b15cde70d85749689e08106f973bb002     |
| protocol_port       | 80                                   |
| provisioning_status | PENDING_CREATE                       |
| subnet_id           | 32259126-dd37-44d5-922c-99d68ee870cd |
| updated_at          | None                                 |
| weight              | 1                                    |
| monitor_port        | None                                 |
| monitor_address     | None                                 |
| backup              | False                                |
+---------------------+--------------------------------------+
</code></pre></div></div><p>It should be noted here that the two IP’s from 10.0.0. * already exist, listening on port 80 (web server), and deliver a simple website with the information about their service name. Assuming these web servers in the following example are Ubuntu/Debian and you have root permissions, you could quickly create a simple web page with:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@BeispielInstanz1:~# apt-get update<span class="p">;</span> apt-get <span class="nt">-y</span> <span class="nb">install </span>apache2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"you hit: you hit: webserver1"</span> <span class="o">&gt;</span> /var/www/html/index.html


</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@BeispielInstanz2:~# apt-get update<span class="p">;</span> apt-get <span class="nt">-y</span> <span class="nb">install </span>apache2<span class="p">;</span> <span class="nb">echo</span> <span class="s2">"you hit: you hit: webserver2"</span> <span class="o">&gt;</span> /var/www/html/index.html


</code></pre></div></div><p>We can check the status of created members as follows:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer member list Beispiel-pool
+--------------------------------------+------+----------------------------------+---------------------+--------------+---------------+------------------+--------+
| <span class="nb">id</span>                                   | name | project_id                       | provisioning_status | address      | protocol_port | operating_status | weight |
+--------------------------------------+------+----------------------------------+---------------------+--------------+---------------+------------------+--------+
| 703e27e0-e7fe-474b-b32d-68f9a8aeef07 |      | b15cde70d85749689e08106f973bb002 | ACTIVE              | 10.0.0.11    |            80 | NO_MONITOR       |      1 |
| 2add1e17-73a6-4002-82af-538a3374e5dc |      | b15cde70d85749689e08106f973bb002 | ACTIVE              | 10.0.0.12    |            80 | NO_MONITOR       |      1 |
+--------------------------------------+------+----------------------------------+---------------------+--------------+---------------+------------------+--------+
</code></pre></div></div><p>Now the “internal” construct of the loadbalancer is configured.</p><p>We now have:</p><ul><li>2 <code class="language-plaintext highlighter-rouge">member</code>s who provide the actual service via port 80 and between which the loadbalancing takes place,<li>a <code class="language-plaintext highlighter-rouge">pool</code> for this <code class="language-plaintext highlighter-rouge">member</code>,<li>a <code class="language-plaintext highlighter-rouge">listener</code> which listens on port TCP/80 and makes a <code class="language-plaintext highlighter-rouge">ROUND_ROBIN</code> to the two endpoints and<li>a loadbalancer, which we used to combine all components.</ul><p>The <code class="language-plaintext highlighter-rouge">operating_status</code> <code class="language-plaintext highlighter-rouge">NO_MONITOR</code> is corrected under <a href="step24.md#create-a-healthmonitor">healthmonitor</a>.</p><h2 id="create-and-configure-the-floating-ip"> <a href="#create-and-configure-the-floating-ip" class="anchor-heading" aria-labelledby="create-and-configure-the-floating-ip"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create and configure the floating IP</h2><p>In order to be able to use the loadbalancer outside of our example network, we must reserve a floating IP and then link it to the <code class="language-plaintext highlighter-rouge">vip_port_id</code> of the <code class="language-plaintext highlighter-rouge">example LB</code>.</p><p>Using the following command we can create a Floating IP from the <code class="language-plaintext highlighter-rouge">provider</code> network:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack floating ip create provider
+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field               | Value                                                                                                                                                                                                    |
+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| created_at          | 2019-05-01T09:00:00Z                                                                                                                                                                                     |
| description         |                                                                                                                                                                                                          |
| dns_domain          | None                                                                                                                                                                                                     |
| dns_name            | None                                                                                                                                                                                                     |
| fixed_ip_address    | None                                                                                                                                                                                                     |
| floating_ip_address | 185.116.247.133                                                                                                                                                                                          |
| floating_network_id | 54258498-a513-47da-9369-1a644e4be692                                                                                                                                                                     |
| <span class="nb">id</span>                  | 46c0e8cf-783d-44a0-8256-79f8ae0be7fe                                                                                                                                                                     |
| location            | Munch<span class="o">({</span><span class="s1">'project'</span>: Munch<span class="o">({</span><span class="s1">'domain_id'</span>: <span class="s1">'default'</span>, <span class="s1">'id'</span>: u<span class="s1">'b15cde70d85749689e08106f973bb002'</span>, <span class="s1">'name'</span>: <span class="s1">'beispiel-tenant'</span>, <span class="s1">'domain_name'</span>: None<span class="o">})</span>, <span class="s1">'cloud'</span>: <span class="s1">''</span>, <span class="s1">'region_name'</span>: <span class="s1">'fra'</span>, <span class="s1">'zone'</span>: None<span class="o">})</span> |
| name                | 185.116.247.133                                                                                                                                                                                          |
| port_details        | None                                                                                                                                                                                                     |
| port_id             | None                                                                                                                                                                                                     |
| project_id          | b15cde70d85749689e08106f973bb002                                                                                                                                                                         |
| qos_policy_id       | None                                                                                                                                                                                                     |
| revision_number     | 0                                                                                                                                                                                                        |
| router_id           | None                                                                                                                                                                                                     |
| status              | DOWN                                                                                                                                                                                                     |
| subnet_id           | None                                                                                                                                                                                                     |
| tags                | <span class="o">[]</span>                                                                                                                                                                                                       |
| updated_at          | 2019-05-01T09:00:00Z                                                                                                                                                                                     |
+---------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

</code></pre></div></div><p>In the next step we need the vip_port_id of the loadbalancer. Accomplished with the following command:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer show Beispiel-LB <span class="nt">-f</span> value <span class="nt">-c</span> vip_port_id
37fc5b34-ee07-49c8-b054-a8d591a9679f
</code></pre></div></div><p>With the following command we can now assign the public IP address to the loadbalancer. The LB (and thus also the endpoints behind it) can now be reached from the Internet.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack floating ip <span class="nb">set</span> <span class="nt">--port</span> 37fc5b34-ee07-49c8-b054-a8d591a9679f 185.116.247.133

</code></pre></div></div><p>We are now ready to test our loadbalancer deployment. With the following command we query our loadbalancer via port TCP/80 and then get a corresponding response from the single <code class="language-plaintext highlighter-rouge">member</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span>1<span class="p">;</span>i&lt;<span class="o">=</span>10<span class="p">;</span>i++<span class="o">))</span><span class="p">;</span> <span class="k">do </span>curl http://185.116.247.133<span class="p">;</span> <span class="nb">sleep </span>1<span class="p">;</span> <span class="k">done
</span>you hit: webserver1
you hit: webserver2
you hit: webserver1
you hit: webserver2
you hit: webserver1
you hit: webserver2
you hit: webserver1
... <span class="o">(</span>usw.<span class="o">)</span>
</code></pre></div></div><h2 id="create-a-healthmonitor"> <a href="#create-a-healthmonitor" class="anchor-heading" aria-labelledby="create-a-healthmonitor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a healthmonitor</h2><p>With the following command we create a monitor that, in the event of a failure of one of the backends, can remove a faulty backend from the load distribution, thus allowing the website or application to continue to be delivered cleanly.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer healthmonitor create <span class="nt">--delay</span> 5 <span class="nt">--max-retries</span> 2 <span class="nt">--timeout</span> 10 <span class="nt">--type</span> HTTP <span class="nt">--name</span> Beispielmonitor <span class="nt">--url-path</span> / Beispiel-pool
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| project_id          | b15cde70d85749689e08106f973bb002     |
| name                | Beispielmonitor                      |
| admin_state_up      | True                                 |
| pools               | 4053e88e-c2b5-47c6-987e-4387d837c88d |
| created_at          | 2019-05-01T09:00:00                  |
| provisioning_status | PENDING_CREATE                       |
| updated_at          | None                                 |
| delay               | 5                                    |
| expected_codes      | 200                                  |
| max_retries         | 2                                    |
| http_method         | GET                                  |
| <span class="nb">timeout</span>             | 10                                   |
| max_retries_down    | 3                                    |
| url_path            | /                                    |
| <span class="nb">type</span>                | HTTP                                 |
| <span class="nb">id</span>                  | 368f9baa-708c-4e7f-ace1-02de15598c5d |
| operating_status    | OFFLINE                              |
| http_version        |                                      |
| domain_name         |                                      |
+---------------------+--------------------------------------+
</code></pre></div></div><p>In this example, the monitor removes the failing backend from the pool if the integrity check (–type HTTP, –url-path / ) fails every two five-second intervals(–delay 5, –max-retries 2, –timeout 10).</p><p>Once the server is restored and responds to TCP/80 again, it will be added back to the pool.</p><p>A manual failover can be enforced if status code of the web server is not equal to “200” or in the event that there is no response from the web server at all.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer healthmonitor show Beispielmonitor
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| project_id          | b15cde70d85749689e08106f973bb002     |
| name                | Beispielmonitor                      |
| admin_state_up      | True                                 |
| pools               | 4053e88e-c2b5-47c6-987e-4387d837c88d |
| created_at          | 2019-05-01T09:00:00                  |
| provisioning_status | ACTIVE                               |
| updated_at          | 2019-05-01T09:00:00                  |
| delay               | 5                                    |
| expected_codes      | 200                                  |
| max_retries         | 2                                    |
| http_method         | GET                                  |
| <span class="nb">timeout</span>             | 10                                   |
| max_retries_down    | 3                                    |
| url_path            | /                                    |
| <span class="nb">type</span>                | HTTP                                 |
| <span class="nb">id</span>                  | 368f9baa-708c-4e7f-ace1-02de15598c5d |
| operating_status    | ONLINE                               |
| http_version        |                                      |
| domain_name         |                                      |
+---------------------+--------------------------------------+
</code></pre></div></div><p>From our deployment example, the result should look something like this:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>you hit: webserver1
Mi 22 Mai 2019 17:09:39 CEST
you hit: webserver2
Mi 22 Mai 2019 17:09:40 CEST
you hit: webserver1
Mi 22 Mai 2019 17:09:41 CEST
you hit: webserver2
Mi 22 Mai 2019 17:09:42 CEST
you hit: webserver1
Mi 22 Mai 2019 17:09:43 CEST - up to now both webservers were online, but now the webserver2 went offline.
you hit: webserver1
Mi 22 Mai 2019 17:09:44 CEST - still expected hit by ROUND_ROBIN
you hit: webserver1
Mi 22 Mai 2019 17:09:50 CEST - first retry to webserver2 fails
you hit: webserver1
Mi 22 Mai 2019 17:09:56 CEST - second retry to webserver2 fails
you hit: webserver1
Mi 22 Mai 2019 17:10:01 CEST - the backend <span class="o">(</span>webserver2<span class="o">)</span> was taken out of the pool.
you hit: webserver1
Mi 22 Mai 2019 17:10:02 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:03 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:04 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:05 CEST
you hit: webserver1
Mi 22 Mai 2019 17:10:06 CEST
</code></pre></div></div><h2 id="monitoring-with-prometheus"> <a href="#monitoring-with-prometheus" class="anchor-heading" aria-labelledby="monitoring-with-prometheus"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Monitoring with Prometheus</h2><p>The Octavia amphora driver provides a Prometheus endpoint. This allows you to collect metrics from Octavia load balancers.</p><p>To add a Prometheus endpoint on an existing Octavia load balancer, create a listener with the protocol <code class="language-plaintext highlighter-rouge">PROMETHEUS</code>. This will enable the endpoint as <code class="language-plaintext highlighter-rouge">/metrics</code> on the listener. The listener supports all the features of an Octavia load balancer, such as allowed_cidrs, but it does not support attaching pools or L7 policies. All metrics are identified by the Octavia object ID (UUID) of the resources.</p><p>Note: Currently, UDP and SCTP metrics are not reported via Prometheus endpoints when using the amphora provider.</p><p>For example, to create a Prometheus endpoint on port 8088 for load balancer <code class="language-plaintext highlighter-rouge">lb1</code>, run the following command:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openstack loadbalancer listener create <span class="nt">--name</span> stats-listener <span class="nt">--protocol</span> PROMETHEUS <span class="nt">--protocol-port</span> 8088 lb1
+-----------------------------+--------------------------------------+
| Field                       | Value                                |
+-----------------------------+--------------------------------------+
| admin_state_up              | True                                 |
| connection_limit            | <span class="nt">-1</span>                                   |
| created_at                  | 2021-10-03T01:44:25                  |
| default_pool_id             | None                                 |
| default_tls_container_ref   | None                                 |
| description                 |                                      |
| <span class="nb">id</span>                          | fb57d764-470a-4b6b-8820-627452f55b96 |
| insert_headers              | None                                 |
| l7policies                  |                                      |
| loadbalancers               | b081ed89-f6f8-48cb-a498-5e12705e2cf9 |
| name                        | stats-listener                       |
| operating_status            | OFFLINE                              |
| project_id                  | 4c1caeee063747f8878f007d1a323b2f     |
| protocol                    | PROMETHEUS                           |
| protocol_port               | 8088                                 |
| provisioning_status         | PENDING_CREATE                       |
| sni_container_refs          | <span class="o">[]</span>                                   |
| timeout_client_data         | 50000                                |
| timeout_member_connect      | 5000                                 |
| timeout_member_data         | 50000                                |
| timeout_tcp_inspect         | 0                                    |
| updated_at                  | None                                 |
| client_ca_tls_container_ref | None                                 |
| client_authentication       | NONE                                 |
| client_crl_container_ref    | None                                 |
| allowed_cidrs               | None                                 |
| tls_ciphers                 | None                                 |
| tls_versions                | None                                 |
| alpn_protocols              | None                                 |
| tags                        |                                      |
+-----------------------------+--------------------------------------+
</code></pre></div></div><p>Once the PROMETHEUS listener is ACTIVE, you can configure Prometheus to collect metrics from the load balancer by updating the prometheus.yml file.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">[</span><span class="nv">scrape_configs</span><span class="pi">]</span>
<span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Octavia</span><span class="nv"> </span><span class="s">LB1'</span>
  <span class="na">static_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">192.0.2.10:8088'</span><span class="pi">]</span>
</code></pre></div></div><h2 id="known-issues"> <a href="#known-issues" class="anchor-heading" aria-labelledby="known-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Known Issues</h2><p>If you get the following error when assigning the public IP address to the loadbalancer:</p><p><code class="language-plaintext highlighter-rouge"> ResourceNotFound: 404: Client Error for url: https://network.fra.optimist.gec.io/v2.0/floatingips/46c0e8cf-783d-44a0-8256-79f8ae0be7fe, External network 54258498-a513-47da-9369-1a644e4be692 is not reachable from subnet 32259126-dd37-44d5-922c-99d68ee870cd. Therefore, cannot associate Port 37fc5b34-ee07-49c8-b054-a8d591a9679f with a Floating IP. </code></p><p>Then a connection between its example network (router) and the provider network is missing <a href="/optimist/guided_tour/step10/">Step 10</a></p><p>The default connect settings of the haproxy processes within an amphora is 50 seconds. If a connection lasts longer than 50 seconds, you must configure these values on the listener.</p><p>An example of a connect with timeout:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">time </span>kubectl <span class="nt">-n</span> kube-system <span class="nb">exec</span> <span class="nt">-ti</span> machine-controller-5f649c5ff4-pksps /bin/sh
~ <span class="err">$</span>
50.69 real         0.08 user         0.05 sys
</code></pre></div></div><p>An example extending the timeout to 4h:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openstack loadbalancer listener <span class="nb">set</span> <span class="nt">--timeout_client_data</span> 14400000 &lt;Listener ID&gt;
openstack loadbalancer listener <span class="nb">set</span> <span class="nt">--timeout_member_data</span> 14400000 &lt;Listener ID&gt;
</code></pre></div></div><p>If Octavia tries to start a LB in a network with <code class="language-plaintext highlighter-rouge">port_security_enabled = False</code>, the LB will end up in an ERROR state.</p><h2 id="conclusion"> <a href="#conclusion" class="anchor-heading" aria-labelledby="conclusion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Conclusion</h2><p>It always makes sense to establish a monitor for your pool. <img src="attachments/201905S240012.png" alt="" /></p></main><hr><footer> <br/><br/><br/><div class="footer-navigation-links"> <a class="footer-navigation-link footer-navigation-link--previous" href="/optimist/networking/shared_networks/"> <svg class="footer-navigation-link__icon" viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> <span class="footer-navigation-link__sublabel">Previous</span> <span class="footer-navigation-link__label">Shared Networks</span> </a> <a class="footer-navigation-link footer-navigation-link--next" href="/optimist/networking/vpnaas/"> <svg class="footer-navigation-link__icon" viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> <span class="footer-navigation-link__sublabel">Next</span> <span class="footer-navigation-link__label">VPN as a Service</span> </a></div><div class="footer-links"><div class=footer-hosted-with-love> <a href="https://github.com/gecio/gecio.github.io" target="_blank" rel="noopener noreferrer" >Hosted with love on GitHub</a></div><div class="footer-external-links"><ul><li class="footer-external-link"> <a href="https://gec.io" target="_blank" rel="noopener noreferrer" >Website</a ><li class="footer-external-link"> <a href="https://gec.io/impressum/" target="_blank" rel="noopener noreferrer" >Imprint</a ><li class="footer-external-link"> <a href="https://gec.io/datenschutz/" target="_blank" rel="noopener noreferrer" >Data Privacy</a ></ul></div></div></footer></div></div><div class="search-overlay"></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script> <script> var config = {} ; mermaid.initialize(config); window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid')); </script>
